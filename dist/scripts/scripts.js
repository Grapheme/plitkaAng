"use strict";angular.module("plitkaApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$httpProvider",function(a){a.defaults.cache=!0}]).run(["$http",function(a){a.get("http://plitka.dev.grapheme.ru/application/get").success(function(){$(".loader").fadeOut(400)})}]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"MCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl",controllerAs:"AbCtrl"}).when("/contacts",{templateUrl:"views/contacts.html",controller:"ContactsCtrl",controllerAs:"ContCtrl"}).when("/articles",{templateUrl:"views/articles.html",controller:"ArticlesCtrl",controllerAs:"ArtCtrl"}).when("/catalog",{templateUrl:"views/catalog.html",controller:"CatalogCtrl",controllerAs:"CatCtrl"}).when("/catalog/:id",{templateUrl:"views/catalog.html",controller:"CatalogCtrl",controllerAs:"CatCtrl"}).when("/projects",{templateUrl:"views/projects.html",controller:"ProjectsCtrl",controllerAs:"ProjCtrl"}).when("/article/:id",{templateUrl:"views/separticle.html",controller:"SeparticleCtrl",controllerAs:"SepCtrl"}).when("/404",{templateUrl:"views/404.html"}).when("/search-results",{templateUrl:"views/search-results.html",controller:"SearchResultsCtrl",controllerAs:"SResultsCtrl"}).when("/catalog-item/:id",{templateUrl:"views/catalog-item.html",controller:"CatalogItemCtrl",controllerAs:"CatItemCtrl"}).when("/collection/:id",{templateUrl:"views/collection.html",controller:"CollectionCtrl",controllerAs:"CollCtrl"}).otherwise({redirectTo:"/404"})}]),angular.module("plitkaApp").controller("MainCtrl",["$http","$rootScope",function(a){var b=this;a.get("http://plitka.dev.grapheme.ru/application/get").success(function(a){b.data=a,b.articles=b.data.articles,b.photos=b.data.photos,b.galleries=b.data.galleries,b.factories=b.data.factory,b.countries=b.data.countries,b.collectionPrices=b.data.collections_prices,b.articlesArr=$.map(b.articles,function(a){return[a]}),console.log(b.articlesArr),b.promo=b.data.promo,b.collections=b.data.collections,b.recCollections=[];for(var c in b.collections)1==b.collections[c].show_on_mainpage&&b.recCollections.push(b.collections[c]);setTimeout(function(){jQuery(".fotorama").fotorama({width:"100%",height:"400",nav:!1,arrows:"always",autoplay:3e3,loop:!0})},100)})}]),angular.module("plitkaApp").controller("AboutCtrl",["$http",function(a){var b=this;a.get("http://plitka.dev.grapheme.ru/application/get").success(function(a){b.data=a,b.photos=b.data.photos,b.gallery=b.data.galleries[69],b.slides=b.gallery.photos,setTimeout(function(){jQuery(".fotorama").fotorama({width:"100%",height:"400",nav:!1,arrows:"always",autoplay:3e3,loop:!0})},100)})}]),angular.module("plitkaApp").controller("ContactsCtrl",["$http",function(a){var b=this;this.mapTo="salon",this.mapCoords={salon:{x:47.244747,y:39.723161},store:{x:47.249539,y:39.621147}},this.setMap=function(a){this.mapTo=a,this.initialize(this.mapCoords[this.mapTo])},this.checkMap=function(a){return this.mapTo===a},this.initialize=function(a){{var b={zoom:15,zoomControl:!1,draggable:!1,scrollwheel:!1,center:new google.maps.LatLng(a.x,a.y),mapTypeId:google.maps.MapTypeId.ROADMAP},c=new google.maps.Map(document.getElementById("map_canvas"),b);new google.maps.Marker({position:b.center,map:c})}},this.setMap("salon"),this.formData={},this.sendForm=function(a){$.ajax({type:"POST",url:"http://plitka.dev.grapheme.ru/ajax/feedback",data:{name:a.name,email:a.email,text:a.text},dataType:"json"}).done(function(){$(".feedback-form").addClass("sended").html("<p><strong>Спасибо!</strong></p><p>Мы получили ваше сообщение и постараемся<br>как можно быстрее ответить</p>")}).fail(function(){}).always(function(){})},a.get("http://plitka.dev.grapheme.ru/application/get").success(function(a){b.data=a,b.contactsDataBlocks=b.data.pages.contacts.blocks,b.header=b.data.pages.contacts.name,b.phones=b.contactsDataBlocks.phones.content,b.workTime=b.contactsDataBlocks["work-time-clearfix"].content,b.contactsColumn=b.contactsDataBlocks["contacts-column"].content})}]),angular.module("plitkaApp").controller("ArticlesCtrl",["$http","$rootScope",function(a){var b=this;a.get("http://plitka.dev.grapheme.ru/application/get").success(function(a){b.data=a,b.articles=b.data.articles,b.photos=b.data.photos})}]),angular.module("plitkaApp").controller("CatalogCtrl",["$http","$routeParams","$cookies",function(a,b,c){var d=this;a.get("http://plitka.dev.grapheme.ru/application/get").success(function(a){if(d.data=a,d.catalogHeader="Каталог",console.log(c),c.countryFilter){console.log("country");var e=c.countryFilter.split(",");console.log(e);for(var f=0;f<e.length;f++)$('[data-country="'+e[f]+'"]').trigger("click")}if(c.factoryFilter){console.log("factory");var g=c.factoryFilter.split(",");console.log(g);for(var f=0;f<g.length;f++)setTimeout(function(){$('[data-factory="'+g[f]+'"]').trigger("click")},1e3)}if(c.colorFilter){console.log("color");var h=c.colorFilter.split(",");console.log(h);for(var f=0;f<h.length;f++)setTimeout(function(){$('[data-color="'+h[f]+'"]').trigger("click")},1e3)}if(c.filterPriceText&&console.log("price"),c.placeFilter){console.log("place");var i=c.placeFilter.split(",");console.log(i);for(var f=0;f<i.length;f++)setTimeout(function(){$('[data-place="'+i[f]+'"]').trigger("click")},1e3)}if(c.formatFilter){console.log("format");var j=c.formatFilter.split(",");console.log(j);for(var f=0;f<j.length;f++)setTimeout(function(){$('[data-format="'+j[f]+'"]').trigger("click")},1e3)}if(c.surfaceTypesFilter){console.log("surfaceType");var k=c.surfaceTypesFilter.split(",");console.log(k);for(var f=0;f<k.length;f++)setTimeout(function(){$('[data-surface-type="'+k[f]+'"]').trigger("click")},1e3)}if(c.surfaceFilter){console.log("surface");var l=c.surfaceFilter.split(",");console.log(l);for(var f=0;f<l.length;f++)setTimeout(function(){$('[data-surface="'+l[f]+'"]').trigger("click")},1e3)}if(d.productType=d.data.product_type,d.collections=d.data.collections,d.materialsCollections=d.data.product_type_others_collections,d.products=d.data.products,d.countries=d.data.countries,d.factories=d.data.factory,d.photos=d.data.photos,d.galleries=d.data.galleries,d.colors=d.data.colors,d.collectionColors=d.data.collections_colors,d.collectionPrices=d.data.collections_prices,d.surfaceTypes=d.data.surface_type,d.collectionSurfaces=d.data.collections_surface_types,d.places=d.data.scope,d.collectionPlaces=d.data.collections_scopes,d.formats=d.data.format,d.collectionFormats=d.data.collections_formats,d.surfaces=d.data.surface,d.collectionSurfacesTypes=d.data.collections_surfaces,d.chosenProduct=d.productType[Object.keys(d.productType)[0]],d.chosenProductId=d.chosenProduct.id,d.collectionsFilter=[],d.catalogPos=b.type,1==b.id&&75==b.type){for(var m in d.collections)d.collections[m].product_type_id==b.type&&d.collectionsFilter.push(d.collections[m]);d.collections=d.collectionsFilter,d.catalogHeader=d.productType[b.type].name||"Каталог"}if(1==b.id&&76==b.type){for(var m in d.collections)d.collections[m].product_type_id==b.type&&d.collectionsFilter.push(d.collections[m]);d.collections=d.collectionsFilter,d.catalogHeader=d.productType[b.type].name||"Каталог"}if(1==b.id&&76.5==b.type){for(var m in d.collections)(d.collections[m].product_type_id==b.type-.5||d.collections[m].product_type_id==b.type+.5)&&d.collectionsFilter.push(d.collections[m]);d.collections=d.collectionsFilter,d.catalogHeader="Камень"}if(1==b.id&&77==b.type){for(var m in d.collections)d.collections[m].product_type_id==b.type&&d.collectionsFilter.push(d.collections[m]);d.collections=d.collectionsFilter,d.catalogHeader=d.productType[b.type].name||"Каталог"}if(1==b.id&&78==b.type){for(var m in d.collections)d.collections[m].product_type_id==b.type&&d.collectionsFilter.push(d.collections[m]);d.collections=d.collectionsFilter,d.catalogHeader=d.productType[b.type].name||"Каталог"}if(1==b.id&&79==b.type){console.log(d.materialsCollections);for(var m in d.materialsCollections)d.materialsCollections[m].product_type_id==b.type&&d.collectionsFilter.push(d.materialsCollections[m]);d.collections=d.collectionsFilter,d.catalogHeader=d.productType[b.type].name||"Каталог"}1==b.id&&b.places&&setTimeout(function(){$('[data-place="'+b.places+'"]').trigger("click")},100),1==b.id&&b.surface&&setTimeout(function(){$('[data-surface-type="'+b.surface+'"]').trigger("click")},100),1==b.id&&b.factory&&setTimeout(function(){$('[data-factory="'+b.factory+'"]').trigger("click")},100),d.collectionsArr=[];for(var m in d.collections)d.collections[m].product_type_id===d.chosenProductId&&d.collectionsArr.push(d.collections[m]);d.collections=$.map(d.collections,function(a){return[a]}),d.countryFilter=[],d.factoryFilter=[],d.colorFilter=[],d.colorFilterArr=[],d.minPrice="",d.surfaceFilter=[],d.surfaceFilterArr=[],d.placeFilter=[],d.placeFilterArr=[],d.formatFilter=[],d.formatFilterArr=[],d.surfaceTypesFilter=[],d.surfaceTypesFilterArr=[],d.setCountryFilter=function(a){var b=$(".filter-countries");-1==d.countryFilter.indexOf(a)?(d.countryFilter.push(a),b.find('[data-country="'+a+'"]').addClass("active")):(d.countryFilter.splice(d.countryFilter.indexOf(a),1),console.log(a),b.find('[data-country="'+a+'"]').removeClass("active")),c.countryFilter=d.countryFilter;for(var e=b.find(".filter-chosen"),f="",g=0;g<d.countryFilter.length;g++)f+="<li>"+d.countries[d.countryFilter[g]].name+"</li> ";e.html(f)},d.filterByCountries=function(a){return d.countryFilter.length>0?-1!==d.countryFilter.indexOf(a.country_id):!0},d.setFactoryFilter=function(a){var b=$(".filter-factories");-1==d.factoryFilter.indexOf(a)?(d.factoryFilter.push(a),b.find('[data-factory="'+a+'"]').addClass("active")):(d.factoryFilter.splice(d.factoryFilter.indexOf(a),1),b.find('[data-factory="'+a+'"]').removeClass("active")),c.factoryFilter=d.factoryFilter;for(var e=b.find(".filter-chosen"),f="",g=0;g<d.factoryFilter.length;g++)f+="<li>"+d.factories[d.factoryFilter[g]].name+"</li> ";e.html(f)},d.filterByFactories=function(a){return d.factoryFilter.length>0?-1!==d.factoryFilter.indexOf(a.factory_id):!0},d.setColorFilter=function(a){var b=$(".filter-colors");-1==d.colorFilter.indexOf(a)?(d.colorFilter.push(a),b.find('[data-color="'+a+'"]').addClass("active")):(d.colorFilter.splice(d.colorFilter.indexOf(a),1),b.find('[data-color="'+a+'"]').removeClass("active")),c.colorFilter=d.colorFilter;for(var e=b.find(".filter-chosen"),f="",g=0;g<d.colorFilter.length;g++)f+='<li style="background-color: #'+d.colors[d.colorFilter[g]].css_code+'"></li> ';if(e.html(f),d.colorFilterArr=[],d.colorFilter.length>0)for(var h=0;h<d.colorFilter.length;h++)for(var i=0;i<d.collectionColors[d.colorFilter[h]].length;i++)-1==d.colorFilterArr.indexOf(d.collectionColors[d.colorFilter[h]][i])&&d.colorFilterArr.push(d.collectionColors[d.colorFilter[h]][i])},d.filterByColors=function(a){return d.colorFilterArr.length>0?-1!==d.colorFilterArr.indexOf(+a.id):!0},d.setPriceFilter=function(a){var b=$(".filter-prices");b.find('[data-price="'+a+'"]').hasClass("active")?(b.find("[data-price]").removeClass("active"),d.minPrice=""):(b.find("[data-price]").removeClass("active"),b.find('[data-price="'+a+'"]').toggleClass("active"),d.minPrice=+a);var e=b.find(".filter-chosen"),f="";f=""!=d.minPrice?b.find('[data-price="'+a+'"]').text():"",c.filterPriceText=f,e.html("<li>"+f+"</li>")},d.filterByPrice=function(a){return 1e3==d.minPrice?d.collectionPrices[a.id]<=1e3:2e3==d.minPrice?d.collectionPrices[a.id]>1e3&&d.collectionPrices[a.id]<=2e3:2001==d.minPrice?d.collectionPrices[a.id]>=2001:!0},d.setSurfaceFilter=function(a){var b=$(".filter-surface");-1==d.surfaceFilter.indexOf(a)?(d.surfaceFilter.push(a),b.find('[data-surface="'+a+'"]').addClass("active")):(d.surfaceFilter.splice(d.surfaceFilter.indexOf(a),1),b.find('[data-surface="'+a+'"]').removeClass("active")),c.surfaceFilter=d.surfaceFilter;for(var e=b.find(".filter-chosen"),f="",g=0;g<d.surfaceFilter.length;g++)f+="<li>"+d.surfaceTypes[d.surfaceFilter[g]].name+"</li> ";if(e.html(f),d.surfaceFilterArr=[],d.surfaceFilter.length>0)for(var h=0;h<d.surfaceFilter.length;h++)for(var i=0;i<d.collectionSurfaces[d.surfaceFilter[h]].length;i++)-1==d.surfaceFilterArr.indexOf(d.collectionSurfaces[d.surfaceFilter[h]][i])&&d.surfaceFilterArr.push(d.collectionSurfaces[d.surfaceFilter[h]][i])},d.filterBySurface=function(a){return d.surfaceFilterArr.length>0?-1!==d.surfaceFilterArr.indexOf(+a.id):!0},d.setPlacesFilter=function(a){var b=$(".filter-place");-1==d.placeFilter.indexOf(a)?(d.placeFilter.push(a),b.find('[data-place="'+a+'"]').addClass("active")):(d.placeFilter.splice(d.placeFilter.indexOf(a),1),b.find('[data-place="'+a+'"]').removeClass("active")),c.placeFilter=d.placeFilter;for(var e=b.find(".filter-chosen"),f="",g=0;g<d.placeFilter.length;g++)f+="<li>"+d.places[d.placeFilter[g]].name+"</li> ";if(e.html(f),d.placeFilterArr=[],d.placeFilter.length>0)for(var h=0;h<d.placeFilter.length;h++)for(var i=0;i<d.collectionPlaces[d.placeFilter[h]].length;i++)-1==d.placeFilterArr.indexOf(d.collectionPlaces[d.placeFilter[h]][i])&&d.placeFilterArr.push(d.collectionPlaces[d.placeFilter[h]][i])},d.filterByPlace=function(a){return d.placeFilterArr.length>0?-1!==d.placeFilterArr.indexOf(a.id):!0},d.setFormatsFilter=function(a){var b=$(".filter-format");-1==d.formatFilter.indexOf(a)?(d.formatFilter.push(a),b.find('[data-format="'+a+'"]').addClass("active")):(d.formatFilter.splice(d.formatFilter.indexOf(a),1),b.find('[data-format="'+a+'"]').removeClass("active")),c.formatFilter=d.formatFilter;for(var e=b.find(".filter-chosen"),f="",g=0;g<d.formatFilter.length;g++)f+="<li>"+d.formats[d.formatFilter[g]].name+"</li> ";if(e.html(f),d.formatFilterArr=[],d.formatFilter.length>0)for(var h=0;h<d.formatFilter.length;h++)for(var i=0;i<d.collectionFormats[d.formatFilter[h]].length;i++)-1==d.formatFilterArr.indexOf(d.collectionFormats[d.formatFilter[h]][i])&&d.formatFilterArr.push(d.collectionFormats[d.formatFilter[h]][i])},d.filterByFormat=function(a){return d.formatFilterArr.length>0?-1!==d.formatFilterArr.indexOf(+a.id):!0},d.setSurfaceTypesFilter=function(a){var b=$(".filter-surface-type");-1==d.surfaceTypesFilter.indexOf(a)?(d.surfaceTypesFilter.push(a),b.find('[data-surface-type="'+a+'"]').addClass("active")):(d.surfaceTypesFilter.splice(d.surfaceTypesFilter.indexOf(a),1),b.find('[data-surface-type="'+a+'"]').removeClass("active")),c.surfaceTypesFilter=d.surfaceTypesFilter;for(var e=b.find(".filter-chosen"),f="",g=0;g<d.surfaceTypesFilter.length;g++)f+="<li>"+d.surfaces[d.surfaceTypesFilter[g]].name+"</li> ";if(e.html(f),d.surfaceTypesFilterArr=[],d.surfaceTypesFilter.length>0)for(var h=0;h<d.surfaceTypesFilter.length;h++)for(var i=0;i<d.collectionSurfacesTypes[d.surfaceTypesFilter[h]].length;i++)-1==d.surfaceTypesFilterArr.indexOf(d.collectionSurfacesTypes[d.surfaceTypesFilter[h]][i])&&d.surfaceTypesFilterArr.push(d.collectionSurfacesTypes[d.surfaceTypesFilter[h]][i])},d.filterBySurfaceTypes=function(a){return d.surfaceTypesFilterArr.length>0?-1!==d.surfaceTypesFilterArr.indexOf(a.id):!0},d.showFilters=function(a){$(a).hasClass("active")?$(a).removeClass("active"):($(".filter").removeClass("active"),$(a).addClass("active"))},$(".filter").click(function(a){a.stopPropagation()}),$(document).click(function(){$(".filter").removeClass("active")})})}]),angular.module("plitkaApp").controller("ProjectsCtrl",["$http",function(a){var b=this;a.get("http://plitka.dev.grapheme.ru/application/get").success(function(a){b.data=a,b.projects=b.data.projects,b.galleries=b.data.galleries,b.photos=b.data.photos,b.collections=b.data.collections,b.products=b.data.products,b.factory=b.data.factory,b.productTypes=b.data.product_type});$(".fancybox").fancybox({padding:0,helpers:{title:{type:"inside"}}})}]),angular.module("plitkaApp").directive("promoSlider",function(){return{templateUrl:"views/partials/slider.html",restrict:"E",controllee:"SliderCtrl"}}),angular.module("plitkaApp").controller("SliderCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("plitkaApp").controller("SeparticleCtrl",["$http","$routeParams",function(a,b){$("html, body").animate({scrollTop:$("main").offset().top},400);var c=this;a.get("http://plitka.dev.grapheme.ru/application/get").success(function(a){c.data=a,c.articleId=b.id,c.articles=c.data.articles,c.photos=c.data.photos})}]),angular.module("plitkaApp").controller("SearchCtrl",["$http","$location","$rootScope","$scope","$route",function(a,b,c,d,e){var f=this;f.searchStr="",f.sendForm=function(a){$.ajax({type:"POST",url:"http://plitka.dev.grapheme.ru/ajax/search",data:{q:a},dataType:"json"}).done(function(a){c.searchData=a,c.searchData.queryStr=f.searchStr,d.$apply(function(){b.path("/search-results")}),e.reload()}).fail(function(){}).always(function(){})}}]),angular.module("plitkaApp").controller("SearchResultsCtrl",["$rootScope","$location","$scope","$http",function(a,b,c,d){var e=this;d.get("http://plitka.dev.grapheme.ru/application/get").success(function(b){e.data=b;var b=a.searchData;if(console.log(a.searchData),b){e.queryStr=b.queryStr,e.articles=b.results.articles,e.collections=b.results.collections,e.allCollections=e.data.collections,e.allArticles=e.data.articles,e.photos=e.data.photos,e.galleries=e.data.galleries,e.factories=e.data.factory,e.collectionPrices=e.data.collections_prices,e.articlesArr=[],e.collectionsArr=[],e.resultsCount=0;for(var c in e.articles)e.resultsCount++,e.articlesArr.push(c);for(var d in e.collections)e.resultsCount++,e.collectionsArr.push(d);e.searchCollections=[];for(var f=0;f<e.collectionsArr.length;f++)for(var g in e.allCollections)e.collectionsArr[f]==g&&e.searchCollections.push(e.allCollections[g]);console.log(e.articlesArr),e.searchArticles=[];for(var h=0;h<e.articlesArr.length;h++)for(var g in e.allArticles)e.articlesArr[h]==g&&e.searchArticles.push(e.allArticles[g])}})}]),angular.module("plitkaApp").controller("CatalogItemCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("plitkaApp").controller("CollectionCtrl",["$http","$routeParams",function(a,b){var c=this;a.get("http://plitka.dev.grapheme.ru/application/get").success(function(a){c.data=a,c.collectionId=b.id,c.products=c.data.products,c.collections=c.data.collections,c.photos=c.data.photos,c.countries=c.data.countries,c.factories=c.data.factory,c.galleries=c.data.galleries,c.productTypes=c.data.product_type,c.surfaceTypes=c.data.surface_type,c.formats=c.data.format,c.collection=c.collections[c.collectionId],c.collectionPhoto=c.photos[c.galleries[c.collection.gallery_id].photos[0]].full,c.country=c.countries[c.collections[c.collectionId].country_id],c.factoryName=c.factories[c.collections[c.collectionId].factory_id].name,c.factoryImg=c.photos[c.factories[c.collections[c.collectionId].factory_id].image_id].full,c.collectionSurfType=c.productTypes[c.collection.product_type_id].name,c.collectionSurfId=c.productTypes[c.collection.product_type_id].id,c.slides=c.galleries[c.collection.gallery_id].photos,c.sameCollections=[],c.mainFactory=c.collection.factory_id;for(var d in c.collections)c.collections[d].factory_id==c.mainFactory&&c.sameCollections.push(c.collections[d]);if(c.collectionPos=c.sameCollections.map(function(a){return a.id}).indexOf(c.collection.id),c.leftLink=c.sameCollections[c.collectionPos-1]?c.sameCollections[c.collectionPos-1].id:"",c.rightLink=c.sameCollections[c.collectionPos+1]?c.sameCollections[c.collectionPos+1].id:"",setTimeout(function(){jQuery(".fotorama").fotorama({width:"60%",height:"400",nav:!1,arrows:"always",autoplay:3e3,loop:!0})},100),c.dicvals=c.collection.related_dicvals,c.dicvalsArr=[],c.dicvals.length>0)for(var e=0;e<c.dicvals.length;e++)c.dicvalsArr.push(c.dicvals[e].name);c.productsArr=[];for(var d in c.products)c.products[d].collection_id==c.collectionId&&c.productsArr.push(c.products[d])})}]),angular.module("plitkaApp").controller("SubmenuCtrl",["$http","$routeParams","$location",function(a,b){var c=this;c.isActive=function(a){return a===b.type},a.get("http://plitka.dev.grapheme.ru/application/get").success(function(a){c.data=a,c.places=c.data.scope,c.collectionPlaces=c.data.collections_scopes,c.materials=c.data.product_type_others_collections})}]);